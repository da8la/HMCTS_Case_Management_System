<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HMCTS Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:400,700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f3f2f1;
            color: #0b0c0c;
        }
        
        .gds-label {
            font-weight: 700;
            display: block;
            margin-bottom: 8px;
        }

        .gds-input, .gds-textarea, .gds-select {
            border: 2px solid #0b0c0c;
            padding: 8px;
            width: 100%;
            background-color: #ffffff;
        }

        .gds-input:focus, .gds-textarea:focus, .gds-select:focus {
            outline: 3px solid #ffdd00;
            outline-offset: 0;
            border-color: #0b0c0c;
        }

        .gds-button {
            background-color: #00703c;
            color: #ffffff;
            padding: 10px 16px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 0 #002d18;
            position: relative;
            top: 0;
            transition: top 0.1s;
        }
        .gds-button:hover {
            background-color: #005a30;
        }
        .gds-button:active {
            top: 2px;
            box-shadow: none;
        }

        .gds-button--warning {
            background-color: #d4351c;
            box-shadow: 0 2px 0 #57150b;
        }
        .gds-button--warning:hover {
            background-color: #b02b16;
        }
        
        .gds-tag {
            font-size: 0.875rem;
            font-weight: 700;
            padding: 4px 8px;
            display: inline-block;
            text-transform: uppercase;
        }

        .gds-tag-todo { background-color: #1d70b8; color: #fff; }
        .gds-tag-inprogress { background-color: #ffdd00; color: #0b0c0c; }
        .gds-tag-done { background-color: #00703c; color: #fff; }
        
        .task-item {
            border-bottom: 1px solid #b1b4b6;
        }
        .task-item:last-child {
            border-bottom: none;
        }
        
        .modal-backdrop {
            background-color: rgba(0,0,0,0.6);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }

        .gds-error-message {
            color: #d4351c;
            font-weight: 700;
            margin-top: 8px;
        }
        .gds-input-error {
            border-color: #d4351c;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="bg-white border-b-8 border-blue-800 mb-8">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-start h-16">
                <span class="text-black font-bold text-2xl">HMCTS Case Management System</span>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <div class="lg:col-span-1">
            <div class="bg-white p-6">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2">Add a new task</h2>
                <form id="task-form" novalidate>
                    <div class="mb-4">
                        <label for="title" class="gds-label">Title</label>
                        <input type="text" id="title" class="gds-input" required>
                        <p id="title-error" class="gds-error-message hidden"></p>
                    </div>
                    <div class="mb-4">
                        <label for="description" class="gds-label">Description (optional)</label>
                        <textarea id="description" rows="4" class="gds-textarea"></textarea>
                    </div>
                    <div class="mb-4">
                        <label for="dueDate" class="gds-label">Due Date</label>
                        <input type="datetime-local" id="dueDate" class="gds-input" required>
                        <p id="dueDate-error" class="gds-error-message hidden"></p>
                    </div>
                    <button type="submit" class="gds-button w-full">Save Task</button>
                </form>
            </div>
        </div>

        <div class="lg:col-span-2">
            <div class="bg-white p-6">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2">Task List</h2>
                <div class="mb-4 flex flex-col sm:flex-row items-stretch gap-2">
                    <div class="flex-grow">
                        <label for="search-id" class="gds-label">Find by Task ID</label>
                        <input type="text" id="search-id" class="gds-input" placeholder="Enter task ID...">
                    </div>
                    <div class="flex items-end gap-2 mt-2 sm:mt-0">
                         <button id="find-task-btn" class="gds-button h-[45px]">Find</button>
                         <button id="view-all-btn" class="gds-button bg-gray-600 hover:bg-gray-700 shadow-none h-[45px]">View All</button>
                    </div>
                </div>
                <div id="task-list" class="min-h-[300px]">
                    <!-- Tasks will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Modal for Task Details -->
    <div id="task-modal" class="modal-backdrop hidden">
        <div class="bg-white p-8 rounded w-11/12 md:w-1/2 max-w-lg relative">
            <div class="border-b pb-2 mb-4 flex justify-between items-center">
                <h2 id="modal-title" class="text-2xl font-bold">Task Details</h2>
                <button id="close-modal-btn" class="text-2xl font-bold">&times;</button>
            </div>
            <div id="modal-content">
                <!-- Modal content goes here -->
            </div>
        </div>
    </div>

    <!-- Message Box -->
    <div id="message-box" class="modal-backdrop hidden">
        <div class="bg-white p-8 rounded w-11/12 md:w-1/3 max-w-md text-center">
            <h3 class="text-xl font-bold mb-4">System Message</h3>
            <p id="message-text" class="mb-6"></p>
            <div id="message-buttons">
                <!-- Buttons injected by JS -->
            </div>
        </div>
    </div>


    <script>
document.addEventListener('DOMContentLoaded', () => {
    const taskForm = document.getElementById('task-form');
    const taskList = document.getElementById('task-list');
    const modal = document.getElementById('task-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalContent = document.getElementById('modal-content');
    const closeModalBtn = document.getElementById('close-modal-btn');
    
    const messageBox = document.getElementById('message-box');
    const messageText = document.getElementById('message-text');
    const messageButtons = document.getElementById('message-buttons');

    const searchIdInput = document.getElementById('search-id');
    const findTaskBtn = document.getElementById('find-task-btn');
    const viewAllBtn = document.getElementById('view-all-btn');

    const API = {
        _getTasks: () => JSON.parse(localStorage.getItem('tasks') || '[]'),
        _saveTasks: (tasks) => localStorage.setItem('tasks', JSON.stringify(tasks)),

        getTasks: async () => new Promise(resolve => setTimeout(() => resolve(API._getTasks()), 200)),

        getTaskById: async (taskId) => {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    const tasks = API._getTasks();
                    const task = tasks.find(t => t.id === taskId);
                    if (task) {
                        resolve(task);
                    } else {
                        reject({ message: "Task not found with that ID." });
                    }
                }, 200);
            });
        },

        createTask: async (taskData) => {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    if (!taskData.title || !taskData.dueDate) {
                        return reject({ message: "Title and dueDate are required." });
                    }
                    if (new Date(taskData.dueDate) < new Date()) {
                        return reject({ message: "Due date cannot be in the past." });
                    }
                    const tasks = API._getTasks();
                    const newTask = {
                        id: crypto.randomUUID(),
                        status: 'To Do',
                        ...taskData
                    };
                    tasks.push(newTask);
                    API._saveTasks(tasks);
                    resolve(newTask);
                }, 200);
            });
        },
        
        updateTaskStatus: async (taskId, status) => {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    let tasks = API._getTasks();
                    const taskIndex = tasks.findIndex(t => t.id === taskId);
                    if (taskIndex === -1) return reject({ message: "Task not found." });
                    tasks[taskIndex].status = status;
                    API._saveTasks(tasks);
                    resolve(tasks[taskIndex]);
                }, 200);
            });
        },

        deleteTask: async (taskId) => {
            return new Promise(resolve => {
                setTimeout(() => {
                    let tasks = API._getTasks().filter(t => t.id !== taskId);
                    API._saveTasks(tasks);
                    resolve();
                }, 200);
            });
        },
    };

    const showMessage = (message) => {
        messageText.textContent = message;
        messageButtons.innerHTML = `<button class="gds-button message-ok-btn">OK</button>`;
        messageBox.classList.remove('hidden');
        document.querySelector('.message-ok-btn').onclick = () => messageBox.classList.add('hidden');
    };

    const showConfirm = (message, onConfirm) => {
        messageText.textContent = message;
        messageButtons.innerHTML = `
            <button class="gds-button gds-button--warning confirm-yes-btn mr-4">Yes, delete</button>
            <button class="gds-button bg-gray-500 shadow-none hover:bg-gray-600 confirm-no-btn">No, cancel</button>
        `;
        messageBox.classList.remove('hidden');
        
        document.querySelector('.confirm-yes-btn').onclick = () => {
            messageBox.classList.add('hidden');
            onConfirm(true);
        };
        document.querySelector('.confirm-no-btn').onclick = () => {
            messageBox.classList.add('hidden');
            onConfirm(false);
        };
    };

    const displayTasks = (tasks) => {
        taskList.innerHTML = ''; 
        if (!tasks || tasks.length === 0) {
            taskList.innerHTML = '<p class="text-gray-500">No tasks found. Add one to get started or refine your search.</p>';
            return;
        }

        tasks.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));

        tasks.forEach(task => {
            const taskElement = document.createElement('div');
            taskElement.className = 'task-item p-4 flex flex-col md:flex-row justify-between items-start md:items-center gap-4';
            taskElement.dataset.id = task.id;

            const statusTagClass = `gds-tag-${task.status.replace(/\s+/g, '').toLowerCase()}`;
            const formattedDate = new Date(task.dueDate).toLocaleString('en-GB', { day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' });

            taskElement.innerHTML = `
                <div class="flex-grow cursor-pointer task-details-btn">
                    <div class="flex items-center gap-3 mb-1">
                            <h3 class="text-lg font-bold hover:underline">${task.title}</h3>
                            <span class="gds-tag ${statusTagClass}">${task.status}</span>
                    </div>
                    <p class="text-sm text-gray-600">Due: ${formattedDate}</p>
                    <p class="text-xs text-gray-400 mt-1">ID: ${task.id}</p>
                </div>
                <div class="flex items-center gap-2 flex-shrink-0">
                    <select class="gds-select status-select" data-id="${task.id}" aria-label="Change status of ${task.title}">
                        <option value="To Do" ${task.status === 'To Do' ? 'selected' : ''}>To Do</option>
                        <option value="In Progress" ${task.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                        <option value="Done" ${task.status === 'Done' ? 'selected' : ''}>Done</option>
                    </select>
                    <button class="gds-button gds-button--warning delete-btn" data-id="${task.id}" title="Delete Task">Delete</button>
                </div>
            `;
            taskList.appendChild(taskElement);
        });
    }

    const renderTasks = async () => {
        taskList.innerHTML = '<p>Loading tasks...</p>';
        try {
            const tasks = await API.getTasks();
            displayTasks(tasks);
        } catch (error) {
            const errorMessage = `Error loading tasks: ${error.message}`;
            taskList.innerHTML = `<p class="text-red-600 font-bold">${errorMessage}</p>`;
            showMessage(errorMessage);
        }
    };

    const clearFormErrors = () => {
        document.getElementById('title').classList.remove('gds-input-error');
        document.getElementById('title-error').classList.add('hidden');
        document.getElementById('dueDate').classList.remove('gds-input-error');
        document.getElementById('dueDate-error').classList.add('hidden');
    };

    const showFormError = (field, message) => {
        const inputElement = document.getElementById(field);
        const errorElement = document.getElementById(`${field}-error`);
        inputElement.classList.add('gds-input-error');
        errorElement.textContent = message;
        errorElement.classList.remove('hidden');
    };

    taskForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        clearFormErrors();

        const titleInput = document.getElementById('title');
        const dueDateInput = document.getElementById('dueDate');
        const description = document.getElementById('description').value;
        const title = titleInput.value;
        const dueDate = dueDateInput.value;
        
        let isValid = true;
        if (!title.trim()) {
            showFormError('title', 'Title cannot be empty.');
            isValid = false;
        }
        if (!dueDate) {
            showFormError('dueDate', 'Due date cannot be empty.');
            isValid = false;
        } else if (new Date(dueDate) < new Date()) {
            showFormError('dueDate', 'Due date cannot be in the past.');
            isValid = false;
        }

        if (!isValid) return;

        try {
            await API.createTask({ title, description, dueDate });
            showMessage("Task created successfully.");
            taskForm.reset();
            renderTasks();
        } catch (error) {
            showMessage(`Error creating task: ${error.message}`);
        }
    });

    taskList.addEventListener('click', async (e) => {
        const target = e.target;
        
        if (target.classList.contains('delete-btn')) {
            const taskId = target.dataset.id;
            showConfirm('Are you sure you want to delete this task?', async (confirmed) => {
                if (confirmed) {
                    try {
                        await API.deleteTask(taskId);
                        showMessage("Task deleted.");
                        renderTasks();
                    } catch (error) {
                        showMessage(`Error deleting task: ${error.message}`);
                    }
                }
            });
        }
        
        if (target.closest('.task-details-btn')) {
            const taskId = target.closest('.task-item').dataset.id;
            try {
                const task = await API.getTaskById(taskId);
                openModal(task);
            } catch (error) {
                showMessage(error.message);
            }
        }
    });
    
    taskList.addEventListener('change', async (e) => {
        if (e.target.classList.contains('status-select')) {
            const taskId = e.target.dataset.id;
            const newStatus = e.target.value;
            try {
                await API.updateTaskStatus(taskId, newStatus);
                showMessage("Status updated.");
                renderTasks();
            } catch (error) {
                showMessage(`Error updating status: ${error.message}`);
            }
        }
    });

    findTaskBtn.addEventListener('click', async () => {
        const taskId = searchIdInput.value.trim();
        if (!taskId) {
            showMessage("Please enter a Task ID to search for.");
            return;
        }
        try {
            const task = await API.getTaskById(taskId);
            displayTasks([task]);
        } catch (error) {
            showMessage(error.message);
            displayTasks([]);
        }
    });

    viewAllBtn.addEventListener('click', () => {
        searchIdInput.value = '';
        renderTasks();
    });

    const openModal = (task) => {
        modalTitle.textContent = task.title;
        const formattedDate = new Date(task.dueDate).toLocaleString('en-GB');
        const statusTagClass = `gds-tag-${task.status.replace(/\s+/g, '').toLowerCase()}`;

        modalContent.innerHTML = `
            <div class="mb-4">
                <p><strong class="gds-label inline-block mr-2">Status:</strong> <span class="gds-tag ${statusTagClass}">${task.status}</span></p>
                <p><strong class="gds-label inline-block mr-2">Due Date:</strong> ${formattedDate}</p>
                <p><strong class="gds-label inline-block mr-2">Task ID:</strong> ${task.id}</p>
            </div>
            <div class="border-t pt-4 mt-4">
                <h4 class="gds-label">Description:</h4>
                <p class="whitespace-pre-wrap">${task.description || 'No description provided.'}</p>
            </div>
        `;
        modal.classList.remove('hidden');
    };

    const closeModal = () => modal.classList.add('hidden');

    closeModalBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
    });

    renderTasks();
});
</script>
</body>
</html>